## 概括

总的来讲，redis提供了两种存储方式，一种是RDB，一种是AOF，简单理解是，前者的操作类似是直接copy整个数据库到一个文件里面去，就是一个当时的快照；而后者则是保存数据库的每一个操作，最后再根据所有的操作去重建数据库。

## RDB

RDB是每隔那么多时间或者操作数才运行一次持久化的，而它的具体操作是fork出子进程，然后根据共享内存来写到本地，不过需要注意的是，如果redis本身的压力已经很大了，那么fork的时候可能会导致毫秒级的无法响应客户端的请求。如果在设置的save时间点之间崩溃了，那么这之间的数据就会丢失掉。手动保存的指令为BGSAVE和SAVE，要注意的是，SAVE是阻塞操作，而BGSAVE不是。

## AOF

AOF默认策略为每秒fsync，由后台线程来处理。AOF文件就是一个只进行追加的日志文件，它保存着redis的每一条操作，不过相应的，它的体积是要比RDB生成的文件大的。手动指令为BGREWRITEAOF，这个指令也会优化AOF文件，来减少它的体积。

可以用redis-check-aof来修复aof文件。